{% extends "base.html" %}

{% block title %}Student Dashboard{% endblock %}

{% block content %}
<h2>Welcome, {{ usn }}</h2>

<div class="card">
    <h3>Current Status</h3>
    {% if current_subject %}
    <p><strong>Subject:</strong> {{ current_subject }}</p>
    <p><strong>Status:</strong> <span
            class="{% if current_status == 'Present' %}text-success{% else %}text-danger{% endif %}"
            style="font-weight: bold;">{{ current_status }}</span></p>
    {% else %}
    <p>No class ongoing right now.</p>
    {% endif %}
</div>

<div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
    <h3 style="color: white; margin-bottom: 20px;">Overall Attendance</h3>
    <div style="display: flex; justify-content: space-around; align-items: center;">
        <div style="text-align: center;">
            <div style="font-size: 3rem; font-weight: bold;">{{ overall_percentage }}%</div>
            <div style="font-size: 1rem; opacity: 0.9;">{{ total_present }}/{{ total_classes }} Classes</div>
        </div>
        <div style="position: relative; width: 150px; height: 150px;">
            <canvas id="overallChart"></canvas>
        </div>
    </div>
</div>

<h3>Subject-wise Attendance</h3>
<div class="dashboard-grid">
    {% for subject in subject_stats %}
    <a href="/attendance_graph/{{ subject.name }}" class="card dashboard-card"
        style="text-decoration: none; border: 2px solid {% if subject.status_color == 'success' %}#2ecc71{% elif subject.status_color == 'warning' %}#f39c12{% else %}#e74c3c{% endif %};">
        <div style="text-align: center;">
            <i class="fas fa-book"
                style="font-size: 2.5rem; color: {% if subject.status_color == 'success' %}#2ecc71{% elif subject.status_color == 'warning' %}#f39c12{% else %}#e74c3c{% endif %}; margin-bottom: 15px;"></i>
            <h3 style="margin-bottom: 15px;">{{ subject.name }}</h3>
            <div
                style="font-size: 2rem; font-weight: bold; margin: 10px 0; color: {% if subject.status_color == 'success' %}#2ecc71{% elif subject.status_color == 'warning' %}#f39c12{% else %}#e74c3c{% endif %};">
                {{ subject.percentage }}%</div>
            <div style="background: #ecf0f1; border-radius: 10px; height: 12px; margin: 15px 0; overflow: hidden;">
                <div
                    style="background: {% if subject.status_color == 'success' %}#2ecc71{% elif subject.status_color == 'warning' %}#f39c12{% else %}#e74c3c{% endif %}; height: 100%; width: {{ subject.percentage }}%; transition: width 0.3s ease;">
                </div>
            </div>
            <p style="margin: 5px 0; color: #7f8c8d;">{{ subject.present }}/{{ subject.total }} Classes Attended</p>
            <p style="margin-top: 10px; font-size: 0.9rem; color: #4a90e2;">Click for detailed view â†’</p>
        </div>
    </a>
    {% endfor %}
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
tooltip: { enabled: true }
},
cutout: '70%'
}
});
</script>

<style>
    .text-success {
        color: #2ecc71;
    }

    .text-danger {
        color: #e74c3c;
    }

    .text-warning {
        color: #f39c12;
    }

    .dashboard-card {
        transition: all 0.3s ease;
    }

    .dashboard-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    }
</style>
{% endblock %}