{% extends "base.html" %}

{% block title %}Attendance Graph{% endblock %}

{% block content %}
<h2>Attendance for {{ subject }}</h2>

<div class="card">
    <canvas id="attendanceChart"></canvas>
</div>

<div class="card mt-4">
    <h3>Detailed Records</h3>
    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for record in records %}
            <tr>
                <td>{{ record[0] }}</td>
                <td>
                    <span class="{% if record[1] == 'Present' %}text-success{% else %}text-danger{% endif %}"
                        style="font-weight: bold;">
                        {{ record[1] }}
                    </span>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="mt-3 text-center">
    <a href="/dashboard" class="btn btn-secondary">Back to Dashboard</a>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('attendanceChart').getContext('2d');
    const dates = "{{ dates | tojson }}";
    const statuses = "{{ statuses | tojson }}"; // 1 for Present, 0 for Absent

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: dates,
            datasets: [{
                label: 'Attendance (1=Present, 0=Absent)',
                data: statuses,
                borderColor: '#4a90e2',
                backgroundColor: 'rgba(74, 144, 226, 0.2)',
                borderWidth: 2,
                fill: true,
                tension: 0.1,
                stepped: true
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true,
                    max: 1.2,
                    ticks: {
                        stepSize: 1,
                        callback: function (value) {
                            if (value === 0) return 'Absent';
                            if (value === 1) return 'Present';
                            return '';
                        }
                    }
                }
            }
        }
    });
</script>
{% endblock %}